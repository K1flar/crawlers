flowchart TD
    A@{ shape: circle, label: "Начало" }

    A --> B[Инициализация краулера]
    B --> C{Есть начальные URL?}
    C -->|Нет| D[Завершение]
    C -->|Да| E[Запуск горутины crawl]
    E --> F[Для каждого URL асинхронно запрашиваем информацию о странице]
    F --> G[Отправить страницу в очередь на обработку]
    
    subgraph crawl goroutine
        G --> H[Получить обработанную страницу из очереди]
        H --> I{Удалось получить страницу?}
        I -->|Нет| H
        I -->|Да| J{Уже посещали?}
        J -->|Да| H
        J -->|Нет| K[Добавить в посещенные]
        K --> L[Сохранить страницу]
        L --> M{Достигнут лимит страниц?}
        M -->|Да| N[Отправить сигнал остановки]
        M -->|Нет| O{Достигнута максимальная глубина?}
        O -->|Да <br/> Сохраним уже обработанные страницы| H
        O -->|Нет| P[Фильтрация новых URL]
        P --> Q{Есть новые URL?}
        Q -->|Нет| H
        Q -->|Да| R[Для каждого URL асинхронно запрашиваем информацию о странице]
        R --> S[Отправить страницу в очередь на обработку]
        S --> H
    end
    
    N --> T[Остановка worker pool]
    T --> U[Закрытие канала crawlerTasks]
    U --> D